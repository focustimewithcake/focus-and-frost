
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindMap Pro - Ứng dụng tạo sơ đồ tư duy</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6b8cbc;
            --accent-color: #ff6b6b;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --success-color: #28a745;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark-color);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            text-align: center;
            padding: 25px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            position: relative;
        }
        
        .user-info {
            position: absolute;
            right: 20px;
            top: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .app-description {
            font-size: 1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .main-content {
            padding: 25px;
        }
        
        /* Màn hình đăng nhập */
        .login-section {
            max-width: 400px;
            margin: 0 auto;
            padding: 30px;
            text-align: center;
        }
        
        .login-form {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .login-btn {
            width: 100%;
            padding: 12px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .login-btn:hover {
            background: var(--secondary-color);
        }
        
        .register-link {
            margin-top: 20px;
            font-size: 0.9rem;
        }
        
        .register-link a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
        }
        
        /* Phần ứng dụng chính */
        .app-section {
            display: none;
        }
        
        .input-section {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .mode-selector {
            display: flex;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .mode-btn {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: white;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .mode-btn.active {
            background: var(--primary-color);
            color: white;
        }
        
        .mode-btn:not(.active):hover {
            background: #f0f0f0;
        }
        
        .input-area {
            display: none;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            background: white;
        }
        
        .input-area.active {
            display: block;
        }
        
        .text-input {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            resize: vertical;
            line-height: 1.6;
        }
        
        .image-upload-area {
            text-align: center;
            padding: 30px;
            border: 2px dashed var(--secondary-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background-color: rgba(107, 140, 188, 0.05);
            margin-bottom: 15px;
        }
        
        .image-upload-area:hover {
            background-color: rgba(107, 140, 188, 0.1);
        }
        
        .image-upload-area i {
            font-size: 2.5rem;
            color: var(--secondary-color);
            margin-bottom: 10px;
        }
        
        .upload-text {
            margin-bottom: 15px;
        }
        
        .image-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .image-preview {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .image-preview img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }
        
        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .api-info {
            margin: 15px 0;
            padding: 15px;
            background: #d4edda;
            border-radius: 8px;
            border: 1px solid #c3e6cb;
            font-size: 0.9rem;
        }
        
        .generate-btn-container {
            text-align: center;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 30px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-accent {
            background-color: var(--accent-color);
        }
        
        .btn-accent:hover {
            background-color: #ff5252;
        }
        
        .result-section {
            display: none;
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .result-section.active {
            display: block;
        }
        
        .outline-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            max-height: 500px;
            overflow-y: auto;
        }
        
        .outline-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 15px;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 8px;
        }
        
        .outline-item {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }
        
        .outline-item.main {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--dark-color);
            margin-top: 15px;
            padding-left: 0;
        }
        
        .outline-item.main:before {
            content: "•";
            color: var(--primary-color);
            font-size: 1.5rem;
            position: absolute;
            left: -5px;
        }
        
        .outline-item.sub {
            padding-left: 30px;
            color: #555;
        }
        
        .outline-item.detail {
            padding-left: 50px;
            color: #777;
            font-size: 0.95rem;
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .status-message {
            margin: 15px 0;
            padding: 12px;
            border-radius: 8px;
            display: none;
            font-size: 0.95rem;
            text-align: center;
        }
        
        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status-info {
            background-color: #e7f3ff;
            color: #004085;
            border: 1px solid #b8daff;
        }
        
        .progress-container {
            margin: 15px 0;
            display: none;
        }
        
        .progress-bar {
            height: 6px;
            background-color: #eee;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            width: 0%;
            transition: width 0.4s;
        }
        
        .progress-text {
            font-size: 0.9rem;
            color: #666;
            text-align: center;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #6c757d;
            background-color: #f8f9fa;
            border-top: 1px solid #eee;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .container {
                border-radius: 10px;
            }
            
            header {
                padding: 20px 15px;
            }
            
            .user-info {
                position: static;
                justify-content: center;
                margin-top: 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .mode-selector {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .outline-container {
                max-height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>MindMap Pro</h1>
            <p class="app-description">Ứng dụng tạo sơ đồ tư duy thông minh</p>
            <div class="user-info" id="userInfo" style="display: none;">
                <div class="user-avatar" id="userAvatar">U</div>
                <span id="userName">Người dùng</span>
                <button class="logout-btn" id="logoutBtn">Đăng xuất</button>
            </div>
        </header>
        
        <div class="main-content">
            <!-- Màn hình đăng nhập -->
            <div class="login-section" id="loginSection">
                <h2>Đăng nhập vào MindMap Pro</h2>
                <div class="login-form">
                    <div class="form-group">
                        <label for="username">Tên đăng nhập</label>
                        <input type="text" id="username" class="form-control" placeholder="Nhập tên đăng nhập">
                    </div>
                    <div class="form-group">
                        <label for="password">Mật khẩu</label>
                        <input type="password" id="password" class="form-control" placeholder="Nhập mật khẩu">
                    </div>
                    <button class="login-btn" id="loginBtn">Đăng nhập</button>
                    <div class="register-link">
                        Chưa có tài khoản? <a href="#" id="registerLink">Đăng ký ngay</a>
                    </div>
                </div>
                
                <div class="api-info">
                    <i class="fas fa-info-circle"></i> 
                    Ứng dụng đã được tích hợp sẵn AI. Bạn không cần nhập API Key!
                </div>
            </div>
            
            <!-- Ứng dụng chính (sau khi đăng nhập) -->
            <div class="app-section" id="appSection">
                <div class="input-section">
                    <div class="mode-selector">
                        <button class="mode-btn active" data-mode="text">
                            <i class="fas fa-font"></i> Chế độ văn bản
                        </button>
                        <button class="mode-btn" data-mode="image">
                            <i class="fas fa-image"></i> Chế độ hình ảnh
                        </button>
                    </div>
                    
                    <div class="input-area active" id="text-input-area">
                        <textarea class="text-input" id="textInput" placeholder="Nhập văn bản của bạn vào đây... Ví dụ: Sơ đồ tư duy là công cụ trực quan giúp tổ chức thông tin. Nó bắt đầu từ ý tưởng trung tâm, sau đó phát triển các nhánh ý tưởng phụ. Mỗi nhánh có thể có các ý con chi tiết hơn. Sơ đồ tư duy giúp kích thích tư duy sáng tạo và cải thiện trí nhớ."></textarea>
                    </div>
                    
                    <div class="input-area" id="image-input-area">
                        <div class="image-upload-area" id="imageUploadArea">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p class="upload-text">Nhấn để chọn hình ảnh (tối đa 3 ảnh)</p>
                            <button class="btn">
                                <i class="fas fa-folder-open"></i> Chọn ảnh
                            </button>
                            <input type="file" id="fileInput" accept="image/*" style="display: none;" multiple>
                        </div>
                        
                        <div class="image-preview-container" id="imagePreviewContainer">
                            <!-- Ảnh xem trước sẽ hiển thị ở đây -->
                        </div>
                    </div>
                    
                    <div class="generate-btn-container">
                        <button class="btn" id="generateBtn">
                            <i class="fas fa-brain"></i> Phân tích AI & Tạo Dàn Ý
                        </button>
                    </div>
                    
                    <div class="progress-container" id="progressContainer">
                        <div class="progress-bar">
                            <div class="progress" id="progress"></div>
                        </div>
                        <div class="progress-text" id="progressText">Đang phân tích nội dung...</div>
                    </div>
                    
                    <div id="statusMessage" class="status-message"></div>
                </div>
                
                <div class="result-section" id="resultSection">
                    <h2 class="outline-title">Dàn Ý Sơ Đồ Tư Duy được tạo bởi AI</h2>
                    <p>Dưới đây là dàn ý được AI phân tích từ nội dung của bạn. Bạn có thể sử dụng dàn ý này để xây dựng sơ đồ tư duy chi tiết.</p>
                    
                    <div class="outline-container" id="outlineContainer">
                        <!-- Dàn ý sẽ được hiển thị ở đây -->
                        <div class="empty-message">
                            <i class="fas fa-project-diagram"></i>
                            <p>Chưa có dàn ý. Hãy nhập nội dung và nhấn "Phân tích AI & Tạo Dàn Ý"</p>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn" id="copyOutlineBtn">
                            <i class="fas fa-copy"></i> Sao chép Dàn Ý
                        </button>
                        <button class="btn btn-accent" id="downloadOutlineBtn">
                            <i class="fas fa-download"></i> Tải xuống Dàn Ý
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>© 2023 MindMap Pro | Ứng dụng tạo sơ đồ tư duy với AI tích hợp sẵn</p>
        </footer>
    </div>

    <script>
        // API Key được quản lý tập trung (trong thực tế, đây sẽ là API key của server)
        const MANAGED_API_KEY = "sk-mindmappro-2023-integrated-ai-system";
        
        // Mô phỏng cơ sở dữ liệu người dùng (trong thực tế, đây sẽ là database)
        const users = {
            "admin": { password: "admin123", name: "Quản trị viên" },
            "user1": { password: "user1123", name: "Người dùng 1" },
            "demo": { password: "demo123", name: "Tài khoản Demo" }
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            // Các phần tử DOM
            const loginSection = document.getElementById('loginSection');
            const appSection = document.getElementById('appSection');
            const userInfo = document.getElementById('userInfo');
            const userAvatar = document.getElementById('userAvatar');
            const userName = document.getElementById('userName');
            const logoutBtn = document.getElementById('logoutBtn');
            const loginBtn = document.getElementById('loginBtn');
            const registerLink = document.getElementById('registerLink');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            
            const modeBtns = document.querySelectorAll('.mode-btn');
            const textInputArea = document.getElementById('text-input-area');
            const imageInputArea = document.getElementById('image-input-area');
            const textInput = document.getElementById('textInput');
            const fileInput = document.getElementById('fileInput');
            const imageUploadArea = document.getElementById('imageUploadArea');
            const imagePreviewContainer = document.getElementById('imagePreviewContainer');
            const generateBtn = document.getElementById('generateBtn');
            const progressContainer = document.getElementById('progressContainer');
            const progress = document.getElementById('progress');
            const progressText = document.getElementById('progressText');
            const statusMessage = document.getElementById('statusMessage');
            const resultSection = document.getElementById('resultSection');
            const outlineContainer = document.getElementById('outlineContainer');
            const copyOutlineBtn = document.getElementById('copyOutlineBtn');
            const downloadOutlineBtn = document.getElementById('downloadOutlineBtn');
            
            // Biến toàn cục
            let currentMode = 'text';
            let uploadedImages = [];
            let outlineData = null;
            let currentUser = null;
            
            // Kiểm tra trạng thái đăng nhập khi tải trang
            checkLoginStatus();
            
            // Xử lý đăng nhập
            loginBtn.addEventListener('click', function() {
                const username = usernameInput.value.trim();
                const password = passwordInput.value;
                
                if (!username || !password) {
                    showStatus('Vui lòng nhập đầy đủ thông tin đăng nhập', 'error');
                    return;
                }
                
                if (users[username] && users[username].password === password) {
                    // Đăng nhập thành công
                    currentUser = {
                        username: username,
                        name: users[username].name
                    };
                    
                    // Lưu thông tin đăng nhập vào localStorage
                    localStorage.setItem('mindmap_user', JSON.stringify(currentUser));
                    
                    // Chuyển đến ứng dụng
                    showApp();
                    showStatus(`Chào mừng ${currentUser.name} đến với MindMap Pro!`, 'success');
                } else {
                    showStatus('Tên đăng nhập hoặc mật khẩu không đúng', 'error');
                }
            });
            
            // Xử lý đăng ký (mô phỏng)
            registerLink.addEventListener('click', function(e) {
                e.preventDefault();
                showStatus('Tính năng đăng ký đang được phát triển. Vui lòng sử dụng tài khoản demo: demo/demo123', 'info');
            });
            
            // Xử lý đăng xuất
            logoutBtn.addEventListener('click', function() {
                localStorage.removeItem('mindmap_user');
                currentUser = null;
                showLogin();
                showStatus('Đã đăng xuất thành công', 'success');
            });
            
            // Kiểm tra trạng thái đăng nhập
            function checkLoginStatus() {
                const savedUser = localStorage.getItem('mindmap_user');
                if (savedUser) {
                    currentUser = JSON.parse(savedUser);
                    showApp();
                } else {
                    showLogin();
                }
            }
            
            // Hiển thị màn hình đăng nhập
            function showLogin() {
                loginSection.style.display = 'block';
                appSection.style.display = 'none';
                userInfo.style.display = 'none';
            }
            
            // Hiển thị ứng dụng sau khi đăng nhập
            function showApp() {
                loginSection.style.display = 'none';
                appSection.style.display = 'block';
                userInfo.style.display = 'flex';
                
                // Hiển thị thông tin người dùng
                userName.textContent = currentUser.name;
                userAvatar.textContent = currentUser.name.charAt(0).toUpperCase();
            }
            
            // Xử lý chuyển đổi chế độ
            modeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const mode = this.getAttribute('data-mode');
                    
                    // Cập nhật trạng thái nút
                    modeBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Ẩn tất cả các khu vực nhập liệu
                    document.querySelectorAll('.input-area').forEach(area => {
                        area.classList.remove('active');
                    });
                    
                    // Hiển thị khu vực nhập liệu tương ứng
                    if (mode === 'text') {
                        textInputArea.classList.add('active');
                        currentMode = 'text';
                    } else {
                        imageInputArea.classList.add('active');
                        currentMode = 'image';
                    }
                });
            });
            
            // Xử lý tải lên ảnh
            imageUploadArea.addEventListener('click', function() {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', function() {
                if (!this.files.length) return;
                
                const files = Array.from(this.files);
                
                // Kiểm tra số lượng ảnh
                if (uploadedImages.length + files.length > 3) {
                    showStatus('Bạn chỉ có thể tải lên tối đa 3 ảnh!', 'error');
                    return;
                }
                
                // Xử lý từng file
                files.forEach(file => {
                    // Kiểm tra xem có phải là file ảnh không
                    if (!file.type.match('image.*')) {
                        showStatus('Vui lòng chọn file ảnh (JPEG, PNG, GIF)!', 'error');
                        return;
                    }
                    
                    // Kiểm tra kích thước file (giới hạn 5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        showStatus(`Ảnh "${file.name}" quá lớn. Vui lòng chọn ảnh nhỏ hơn 5MB.`, 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        // Thêm ảnh vào mảng
                        uploadedImages.push({
                            name: file.name,
                            data: e.target.result
                        });
                        
                        // Hiển thị ảnh xem trước
                        displayImagePreview();
                    };
                    
                    reader.readAsDataURL(file);
                });
                
                // Reset input file để cho phép chọn lại cùng file
                this.value = '';
            });
            
            // Hiển thị ảnh xem trước
            function displayImagePreview() {
                imagePreviewContainer.innerHTML = '';
                
                uploadedImages.forEach((image, index) => {
                    const preview = document.createElement('div');
                    preview.className = 'image-preview';
                    
                    preview.innerHTML = `
                        <img src="${image.data}" alt="${image.name}">
                        <button class="remove-image" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    imagePreviewContainer.appendChild(preview);
                });
                
                // Thêm sự kiện xóa ảnh
                document.querySelectorAll('.remove-image').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        uploadedImages.splice(index, 1);
                        displayImagePreview();
                    });
                });
            }
            
            // Xử lý phân tích và tạo dàn ý với AI
            generateBtn.addEventListener('click', async function() {
                // Kiểm tra đăng nhập
                if (!currentUser) {
                    showStatus('Vui lòng đăng nhập để sử dụng tính năng này', 'error');
                    return;
                }
                
                // Kiểm tra nội dung đầu vào
                if (currentMode === 'text' && !textInput.value.trim()) {
                    showStatus('Vui lòng nhập nội dung văn bản', 'error');
                    return;
                }
                
                if (currentMode === 'image' && uploadedImages.length === 0) {
                    showStatus('Vui lòng tải lên ít nhất một hình ảnh', 'error');
                    return;
                }
                
                // Hiển thị tiến trình
                progressContainer.style.display = 'block';
                progress.style.width = '10%';
                progressText.textContent = 'Đang phân tích nội dung...';
                
                // Vô hiệu hóa nút trong quá trình xử lý
                generateBtn.disabled = true;
                
                try {
                    let content = '';
                    
                    if (currentMode === 'text') {
                        content = textInput.value.trim();
                        
                        // Cập nhật tiến trình
                        progress.style.width = '30%';
                        progressText.textContent = 'Đang gửi yêu cầu đến AI...';
                        
                        // Gọi API AI để phân tích văn bản
                        outlineData = await analyzeTextWithAI(content);
                    } else {
                        // Cập nhật tiến trình
                        progress.style.width = '20%';
                        progressText.textContent = 'Đang trích xuất văn bản từ ảnh...';
                        
                        // Mô phỏng trích xuất văn bản từ ảnh
                        const extractedText = await simulateTextExtraction(uploadedImages);
                        
                        // Cập nhật tiến trình
                        progress.style.width = '50%';
                        progressText.textContent = 'Đang phân tích văn bản với AI...';
                        
                        // Gọi API AI để phân tích văn bản trích xuất
                        outlineData = await analyzeTextWithAI(extractedText);
                    }
                    
                    // Cập nhật tiến trình
                    progress.style.width = '100%';
                    progressText.textContent = 'Hoàn thành!';
                    
                    // Hiển thị kết quả
                    renderOutline();
                    resultSection.classList.add('active');
                    
                    // Cuộn đến kết quả
                    resultSection.scrollIntoView({ behavior: 'smooth' });
                    
                    showStatus('Đã tạo dàn ý thành công với AI!', 'success');
                    
                } catch (error) {
                    console.error('Lỗi khi phân tích với AI:', error);
                    showStatus('Lỗi: ' + error.message, 'error');
                } finally {
                    // Ẩn tiến trình và kích hoạt lại nút
                    setTimeout(() => {
                        progressContainer.style.display = 'none';
                        generateBtn.disabled = false;
                    }, 1000);
                }
            });
            
            // Mô phỏng trích xuất văn bản từ hình ảnh
            async function simulateTextExtraction(images) {
                // Trong thực tế, đây sẽ là tích hợp Tesseract.js hoặc API OCR
                // Ở đây chúng ta mô phỏng việc trích xuất
                
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve("Sơ đồ tư duy là công cụ trực quan giúp tổ chức thông tin. Nó bắt đầu từ ý tưởng trung tâm, sau đó phát triển các nhánh ý tưởng phụ. Mỗi nhánh có thể có các ý con chi tiết hơn. Sơ đồ tư duy giúp kích thích tư duy sáng tạo và cải thiện trí nhớ. Ứng dụng trong học tập, công việc và cuộc sống hàng ngày.");
                    }, 1500);
                });
            }
            
            // Phân tích văn bản với AI (sử dụng API Key được quản lý)
            async function analyzeTextWithAI(text) {
                // Mô phỏng gọi API AI với API Key được quản lý
                // Trong thực tế, đây sẽ là gọi đến server của bạn
                
                return new Promise((resolve, reject) => {
                    // Mô phỏng thời gian xử lý của AI
                    setTimeout(() => {
                        try {
                            // Tạo dàn ý mẫu dựa trên nội dung
                            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
                            
                            const outline = {
                                centralTopic: sentences.length > 0 ? sentences[0].trim() : "Chủ đề chính",
                                mainBranches: [
                                    {
                                        title: "Khái niệm và đặc điểm",
                                        subTopics: [
                                            sentences.length > 1 ? sentences[1].trim() : "Định nghĩa cơ bản",
                                            sentences.length > 2 ? sentences[2].trim() : "Đặc điểm nổi bật",
                                            "Tính trực quan và dễ hiểu"
                                        ]
                                    },
                                    {
                                        title: "Ứng dụng và lợi ích",
                                        subTopics: [
                                            sentences.length > 3 ? sentences[3].trim() : "Ứng dụng thực tế",
                                            sentences.length > 4 ? sentences[4].trim() : "Lợi ích mang lại",
                                            "Nâng cao hiệu suất làm việc"
                                        ]
                                    },
                                    {
                                        title: "Phương pháp xây dựng",
                                        subTopics: [
                                            "Xác định chủ đề trung tâm",
                                            "Phát triển các nhánh chính",
                                            "Thêm chi tiết và hình ảnh",
                                            "Sử dụng màu sắc và ký hiệu"
                                        ]
                                    }
                                ]
                            };
                            
                            resolve(outline);
                        } catch (error) {
                            reject(new Error('Không thể phân tích nội dung với AI'));
                        }
                    }, 2000);
                });
            }
            
            // Hiển thị dàn ý
            function renderOutline() {
                if (!outlineData) return;
                
                outlineContainer.innerHTML = '';
                
                // Thêm chủ đề trung tâm
                const centralItem = document.createElement('div');
                centralItem.className = 'outline-item main';
                centralItem.textContent = outlineData.centralTopic;
                outlineContainer.appendChild(centralItem);
                
                // Thêm các nhánh chính
                outlineData.mainBranches.forEach(branch => {
                    const branchItem = document.createElement('div');
                    branchItem.className = 'outline-item main';
                    branchItem.textContent = branch.title;
                    outlineContainer.appendChild(branchItem);
                    
                    // Thêm các ý phụ
                    branch.subTopics.forEach(subTopic => {
                        const subItem = document.createElement('div');
                        subItem.className = 'outline-item sub';
                        subItem.textContent = subTopic;
                        outlineContainer.appendChild(subItem);
                    });
                });
                
                // Thêm ghi chú
                const noteItem = document.createElement('div');
                noteItem.className = 'outline-item detail';
                noteItem.textContent = "※ Dàn ý được tạo tự động bởi AI. Bạn có thể chỉnh sửa để phù hợp hơn với nhu cầu.";
                noteItem.style.fontStyle = 'italic';
                noteItem.style.marginTop = '15px';
                outlineContainer.appendChild(noteItem);
            }
            
            // Xử lý sao chép dàn ý
            copyOutlineBtn.addEventListener('click', function() {
                if (!outlineData) return;
                
                // Tạo văn bản từ dàn ý
                let text = `DÀN Ý SƠ ĐỒ TƯ DUY - TẠO BỞI AI\n\n`;
                text += `Chủ đề trung tâm: ${outlineData.centralTopic}\n\n`;
                
                outlineData.mainBranches.forEach((branch, index) => {
                    text += `${index + 1}. ${branch.title}\n`;
                    branch.subTopics.forEach((subTopic, subIndex) => {
                        text += `   ${subIndex + 1}. ${subTopic}\n`;
                    });
                    text += '\n';
                });
                
                text += `---\nTạo ngày: ${new Date().toLocaleDateString('vi-VN')}\n`;
                text += `Người dùng: ${currentUser.name}`;
                
                // Sao chép vào clipboard
                navigator.clipboard.writeText(text).then(() => {
                    showStatus('Đã sao chép dàn ý vào clipboard!', 'success');
                }).catch(err => {
                    // Fallback cho trình duyệt không hỗ trợ clipboard API
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showStatus('Đã sao chép dàn ý vào clipboard!', 'success');
                });
            });
            
            // Xử lý tải xuống dàn ý
            downloadOutlineBtn.addEventListener('click', function() {
                if (!outlineData) return;
                
                // Tạo văn bản từ dàn ý
                let text = `DÀN Ý SƠ ĐỒ TƯ DUY - TẠO BỞI AI\n\n`;
                text += `Chủ đề trung tâm: ${outlineData.centralTopic}\n\n`;
                
                outlineData.mainBranches.forEach((branch, index) => {
                    text += `${index + 1}. ${branch.title}\n`;
                    branch.subTopics.forEach((subTopic, subIndex) => {
                        text += `   ${subIndex + 1}. ${subTopic}\n`;
                    });
                    text += '\n';
                });
                
                text += `---\nTạo ngày: ${new Date().toLocaleDateString('vi-VN')}\n`;
                text += `Người dùng: ${currentUser.name}\n`;
                text += `Ứng dụng: MindMap Pro`;
                
                // Tạo file và tải xuống
                const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'dan-y-so-do-tu-duy.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showStatus('Đã tải xuống dàn ý thành công!', 'success');
            });
            
            // Hiển thị thông báo trạng thái
            function showStatus(message, type) {
                statusMessage.textContent = message;
                statusMessage.className = 'status-message';
                statusMessage.classList.add(`status-${type}`);
                statusMessage.style.display = 'block';
                
                // Tự động ẩn thông báo sau 5 giây (trừ lỗi)
                if (type !== 'error') {
                    setTimeout(() => {
                        statusMessage.style.display = 'none';
                    }, 5000);
                }
            }
        });
    </script>
</body>
</html>


